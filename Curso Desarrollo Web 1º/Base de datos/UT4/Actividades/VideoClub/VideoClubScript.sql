-- 1)
CREATE TABLE ACTOR (
	NOMBRE VARCHAR2(100) NOT NULL,
	NACIONALIDAD VARCHAR2(50),
	SEXO VARCHAR2(1),
	CONSTRAINT PK_ACTORES PRIMARY KEY (NOMBRE)
);

COMMENT ON TABLE ACTOR IS 'Datos de los actores';
COMMENT ON COLUMN ACTOR.NOMBRE IS 'Nombre del actor';
COMMENT ON COLUMN ACTOR.NACIONALIDAD IS 'Nacionalidad del actor';
COMMENT ON COLUMN ACTOR.SEXO IS 'Sexo del actor, H para hombre, M para mujer';

CREATE TABLE DIRECTOR (
	NOMBRE VARCHAR2(100) NOT NULL,
	NACIONALIDAD VARCHAR2(50),
	CONSTRAINT PK_DIRECTOR PRIMARY KEY (NOMBRE)
);

COMMENT ON TABLE DIRECTOR IS 'Datos de los directores de peliculas';
COMMENT ON COLUMN DIRECTOR.NOMBRE IS 'Nombre del director';
COMMENT ON COLUMN DIRECTOR.NACIONALIDAD IS 'Nacionalidad del director';

SELECT * FROM DIRECTOR;

CREATE TABLE SOCIO (
	DNI VARCHAR2(9) NOT NULL,
	NOMBRE VARCHAR2(100) NOT NULL,
	DIRECCION VARCHAR2(200),
	TELEFONO VARCHAR2(15),
	AVALADOR VARCHAR2(9),
	CONSTRAINT PK_SOCIO PRIMARY KEY (DNI),
	CONSTRAINT FK_SOCIO_AVALADOR FOREIGN KEY (AVALADOR) REFERENCES SOCIO (DNI)
);

COMMENT ON TABLE SOCIO IS 'Datos de los socios del videoclub';
COMMENT ON COLUMN SOCIO.DNI IS 'DNI del socio';
COMMENT ON COLUMN SOCIO.NOMBRE IS 'Nombre del socio';
COMMENT ON COLUMN SOCIO.DIRECCION IS 'Direccion del socio';
COMMENT ON COLUMN SOCIO.TELEFONO IS 'Telefono del socio';
COMMENT ON COLUMN SOCIO.AVALADOR IS 'Socio avalador';

CREATE TABLE PELICULA (
	ID NUMBER NOT NULL,
	TITULO VARCHAR2(200) NOT NULL,
	PRODUCTORA VARCHAR2(200),
	NACIONALIDAD VARCHAR2(50),
	FECHA DATE NOT NULL,
	DIRECTOR VARCHAR2(100) NOT NULL,
	CONSTRAINT PK_PELICULA PRIMARY KEY (ID),
	CONSTRAINT FK_PELICULA_DIRECTOR FOREIGN KEY (DIRECTOR) REFERENCES DIRECTOR (NOMBRE)
);

COMMENT ON TABLE PELICULA IS 'Datos de las películas disponibles en el videoclub';
COMMENT ON COLUMN PELICULA.ID IS 'Identificador de la pelicula';
COMMENT ON COLUMN PELICULA.TITULO IS 'Titulo de la pelicula';
COMMENT ON COLUMN PELICULA.PRODUCTORA IS 'Nombre de la productora de la pelicula';
COMMENT ON COLUMN PELICULA.NACIONALIDAD IS 'Nacionalidad de la pelicula';
COMMENT ON COLUMN PELICULA.FECHA IS 'Fecha de la pelicula';
COMMENT ON COLUMN PELICULA.DIRECTOR IS 'Director de la pelicula';

CREATE SEQUENCE SEC_PELICULA
INCREMENT BY 1
START WITH 1
MAXVALUE 999999999
NOCACHE
ORDER;

CREATE TABLE ACTUA (
	ACTOR VARCHAR2(100) NOT NULL,
	ID_PELI NUMBER NOT NULL,
	PROTA VARCHAR2(1),
	CONSTRAINT PK_ACTUA PRIMARY KEY (ACTOR, ID_PELI),
	CONSTRAINT FK_ACTUA_ACTOR FOREIGN KEY (ACTOR) REFERENCES ACTOR(NOMBRE),
	CONSTRAINT FK_ACTUA_ID_PELI FOREIGN KEY (ID_PELI) REFERENCES PELICULA(ID)
);

COMMENT ON TABLE ACTUA IS 'Datos de los actores que actúan en las peliculas';
COMMENT ON COLUMN ACTUA.ACTOR IS 'Nombre del actor';
COMMENT ON COLUMN ACTUA.ID_PELI IS 'Identificador de la pelicula';
COMMENT ON COLUMN ACTUA.PROTA IS 'S para protagonista, N si no lo es';

SELECT * FROM PELICULA;

CREATE TABLE EJEMPLAR (
	ID_PELI NUMBER NOT NULL,
	NUMERO NUMBER NOT NULL, 
	ESTADO NUMBER(1),
	CONSTRAINT PK_EJEMPLAR PRIMARY KEY (ID_PELI, NUMERO),
	CONSTRAINT FK_EJEMPLAR_ID_PELI FOREIGN KEY (ID_PELI) REFERENCES PELICULA(ID)
);

COMMENT ON TABLE EJEMPLAR IS 'Datos de las copias de las películas que hay en el videoclud';
COMMENT ON COLUMN EJEMPLAR.ID_PELI IS 'Identificador de la pelicula';
COMMENT ON COLUMN EJEMPLAR.NUMERO IS 'Numero de copia de la pelicula';
COMMENT ON COLUMN EJEMPLAR.ESTADO IS 'Estado del ejemplar: 1 disponible, 0 no disponible';

CREATE TABLE ALQUILA (
	DNI VARCHAR2(9) NOT NULL,
	ID_PELI NUMBER NOT NULL,
	NUMERO NUMBER NOT NULL,
	FECHA_ALQUILER DATE NOT NULL,
	FECHA_DEVOLUCION DATE,
	CONSTRAINT PK_ALQUILA PRIMARY KEY (DNI, ID_PELI, NUMERO, FECHA_ALQUILER),
	CONSTRAINT FK_ALQUILA_DNI FOREIGN KEY (DNI) REFERENCES SOCIO (DNI),
	CONSTRAINT FK_ALQUILA_EJEMPLAR FOREIGN KEY (ID_PELI, NUMERO) REFERENCES EJEMPLAR (ID_PELI, NUMERO)
);

COMMENT ON TABLE ALQUILA IS 'Datos de los alquileres de películas realizados en el videoclub';
COMMENT ON COLUMN ALQUILA.DNI IS 'Socio que alquila';
COMMENT ON COLUMN ALQUILA.ID_PELI IS 'Pelicula que alquila';
COMMENT ON COLUMN ALQUILA.NUMERO IS 'Numero de copia de la pelicula que alquila';
COMMENT ON COLUMN ALQUILA.FECHA_ALQUILER IS 'Fecha del alquiler';
COMMENT ON COLUMN ALQUILA.FECHA_DEVOLUCION IS 'Fecha de devolucion';

-- 2)
-- a.
INSERT INTO DIRECTOR (NOMBRE, NACIONALIDAD) VALUES ('Quentin Tarantino', 'USA'); 
INSERT INTO DIRECTOR (NOMBRE, NACIONALIDAD) VALUES ('Alfred Hitchcock', 'USA'); 
INSERT INTO DIRECTOR (NOMBRE, NACIONALIDAD) VALUES ('Pedro Almodovar', 'Spain');
INSERT INTO DIRECTOR (NOMBRE, NACIONALIDAD) VALUES ('Alejandro Amenabar', 'Spain');
INSERT INTO DIRECTOR (NOMBRE, NACIONALIDAD) VALUES ('Roman Polanski', 'Frabce');

COMMIT;

-- b.
INSERT INTO PELICULA (ID, TITULO, PRODUCTORA, NACIONALIDAD, FECHA, DIRECTOR) VALUES (SEC_PELICULA.NEXTVAL, 'Pulp Fiction','A Band Apart; Jersey Films','USA', '01/01/1994','Quentin Tarantino');
INSERT INTO EJEMPLAR (ID_PELI, NUMERO, ESTADO) VALUES (SEC_PELICULA.CURRVAL,1,1);
INSERT INTO EJEMPLAR (ID_PELI, NUMERO, ESTADO) VALUES (SEC_PELICULA.CURRVAL,2,1);
INSERT INTO PELICULA (ID, TITULO, PRODUCTORA, NACIONALIDAD, FECHA, DIRECTOR) VALUES (SEC_PELICULA.NEXTVAL, 'Todo sobre mi madre','El Deseo','Spain', '01/01/1999','Pedro Almodovar');
INSERT INTO EJEMPLAR (ID_PELI, NUMERO, ESTADO) VALUES (SEC_PELICULA.CURRVAL,1,1);
INSERT INTO EJEMPLAR (ID_PELI, NUMERO, ESTADO) VALUES (SEC_PELICULA.CURRVAL,2,1);
INSERT INTO PELICULA (ID, TITULO, PRODUCTORA, NACIONALIDAD, FECHA, DIRECTOR) VALUES (SEC_PELICULA.NEXTVAL, 'Abre los ojos','Sogecine','Spain', '01/01/1997','Alejandro Amenabar');
INSERT INTO EJEMPLAR (ID_PELI, NUMERO, ESTADO) VALUES (SEC_PELICULA.CURRVAL,1,1);
INSERT INTO EJEMPLAR (ID_PELI, NUMERO, ESTADO) VALUES (SEC_PELICULA.CURRVAL,2,1);
INSERT INTO PELICULA (ID, TITULO, PRODUCTORA, NACIONALIDAD, FECHA, DIRECTOR) VALUES (SEC_PELICULA.NEXTVAL, 'El pianista','Studio Babelsberg','USA', '01/01/2002','Roman Polanski');
INSERT INTO EJEMPLAR (ID_PELI, NUMERO, ESTADO) VALUES (SEC_PELICULA.CURRVAL,1,1);
INSERT INTO EJEMPLAR (ID_PELI, NUMERO, ESTADO) VALUES (SEC_PELICULA.CURRVAL,2,1);

COMMIT;

-- c.
INSERT INTO SOCIO (DNI, NOMBRE, DIRECCION, TELEFONO, AVALADOR) VALUES ('70248628G', 'Yolanda Guerrero Garcia', 'c/Fuente del Burgo 21, Madrid', 91657210, NULL);
INSERT INTO SOCIO (DNI, NOMBRE, DIRECCION, TELEFONO, AVALADOR) VALUES ('70255755R', 'Borja Grande Garcia', 'Plaza Zocodover 5, Toledo', 925330302, NULL);
INSERT INTO SOCIO (DNI, NOMBRE, DIRECCION, TELEFONO, AVALADOR) VALUES ('X5150347A', 'Marian Lopez Reina', 'c/Libertad 16, Ciudad Real', 926213040, '70255755R');
INSERT INTO SOCIO (DNI, NOMBRE, DIRECCION, TELEFONO, AVALADOR) VALUES ('70258758Z', 'Vanesa Regalado', 'c/La Paz 7, Ciudad Real', 926270095, NULL);

COMMIT;

-- d.
INSERT INTO ACTOR (NOMBRE, NACIONALIDAD, SEXO) VALUES('John Travolta', 'USA', 'H');
INSERT INTO ACTOR (NOMBRE, NACIONALIDAD, SEXO) VALUES('Penelope Cruz', 'Spain', 'M');
INSERT INTO ACTOR (NOMBRE, NACIONALIDAD, SEXO) VALUES('Cecilia Roth', 'Argentina', 'M');
INSERT INTO ACTOR (NOMBRE, NACIONALIDAD, SEXO) VALUES('Eduardo Noriega', 'Spain', 'H');
INSERT INTO ACTOR (NOMBRE, NACIONALIDAD, SEXO) VALUES('Adrien Brody', 'USA', 'H');
INSERT INTO ACTOR (NOMBRE, NACIONALIDAD, SEXO) VALUES('Uma Thurman', 'USA', 'M');

COMMIT;

-- e.
INSERT INTO ACTUA (ACTOR, ID_PELI, PROTA) VALUES ('John Travolta', 1, 'S');
INSERT INTO ACTUA (ACTOR, ID_PELI, PROTA) VALUES ('Uma Thurman', 1, 'S');
INSERT INTO ACTUA (ACTOR, ID_PELI, PROTA) VALUES ('Penelope Cruz', 2, 'N');
INSERT INTO ACTUA (ACTOR, ID_PELI, PROTA) VALUES ('Cecilia Roth', 2, 'S');
INSERT INTO ACTUA (ACTOR, ID_PELI, PROTA) VALUES ('Eduardo Noriega', 3, 'S');
INSERT INTO ACTUA (ACTOR, ID_PELI, PROTA) VALUES ('Penelope Cruz', 3, 'N');

COMMIT;

-- f.
INSERT INTO ALQUILA (DNI, ID_PELI, NUMERO, FECHA_ALQUILER, FECHA_DEVOLUCION) VALUES ('70248628G', 1, 1, '10/01/2020', NULL);
INSERT INTO ALQUILA (DNI, ID_PELI, NUMERO, FECHA_ALQUILER, FECHA_DEVOLUCION) VALUES ('70255755R', 1, 2, '15/03/2020', '18/03/2020');
INSERT INTO ALQUILA (DNI, ID_PELI, NUMERO, FECHA_ALQUILER, FECHA_DEVOLUCION) VALUES ('X5150347A', 2, 1, '05/02/2020', '15/02/2020');
INSERT INTO ALQUILA (DNI, ID_PELI, NUMERO, FECHA_ALQUILER, FECHA_DEVOLUCION) VALUES ('70258758Z', 2, 2, '05/03/2020', '07/03/2020');
INSERT INTO ALQUILA (DNI, ID_PELI, NUMERO, FECHA_ALQUILER, FECHA_DEVOLUCION) VALUES ('70248628G', 3, 1, '10/04/2020', '12/04/2020');
INSERT INTO ALQUILA (DNI, ID_PELI, NUMERO, FECHA_ALQUILER, FECHA_DEVOLUCION) VALUES ('X5150347A', 3, 2, '06/03/2020', '16/03/2020');

COMMIT;
